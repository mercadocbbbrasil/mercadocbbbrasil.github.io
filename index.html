<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸ‡§ðŸ‡· Mercado Brasil â€” Conectando o Brasil</title>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root{
      --brazil-green:#00c853;
      --brazil-yellow:#ffd600;
      --brazil-blue:#1976d2;
      --dark-green:#009624;
      --light-green:#00e676;
      --glass: rgba(255,255,255,0.06);
      --bg:#ffffff;
      --card:#f5f5f5;
      --text:#222222;
    }
    @media (prefers-color-scheme: dark) {
      :root{
        --brazil-green:#00c853;
        --brazil-yellow:#ffd600;
        --brazil-blue:#1976d2;
        --dark-green:#009624;
        --light-green:#00e676;
        --glass: rgba(255,255,255,0.06);
        --bg:#0f1720;
        --card:#0b1220;
        --text:#e6eef8;
      }
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased;font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;transition:background .3s,color .3s}
    a{color:inherit}
    img{max-width:100%;display:block}
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:var(--brazil-blue);color:#fff}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700}
    .brand .logo{font-size:20px}
    .tag{font-size:12px;color:rgba(255,255,255,0.7)}
    .top-actions{display:flex;gap:12px;align-items:center}
    .btn{background:var(--card);border:1px solid rgba(0,0,0,0.05);padding:8px 12px;border-radius:10px;cursor:pointer;transition:all .2s;color:var(--text)}
    .btn:hover{transform:translateY(-3px)}
    .cart{position:relative}
    .cart .count{position:absolute;top:-6px;right:-6px;background:var(--brazil-yellow);color:#002776;border-radius:50%;padding:4px 7px;font-weight:700;font-size:12px}
    .header-main{display:flex;flex-direction:column;gap:10px;padding:14px 16px}
    .search-wrap{display:flex;gap:12px;align-items:center}
    .search{flex:1;display:flex;background:var(--card);padding:10px;border-radius:14px;border:1px solid rgba(0,0,0,0.05)}
    .search input{flex:1;background:transparent;border:0;color:var(--text);outline:none;padding:6px 8px}
    .nav{display:flex;gap:12px;margin-top:6px}
    .nav a{padding:6px 8px;border-radius:8px;color:var(--text)}
    .nav a:hover{background:rgba(0,0,0,0.05)}
    .container{max-width:1200px;margin:18px auto;padding:0 16px}
    .hero{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:center;padding:22px;border-radius:14px;background:linear-gradient(135deg, var(--brazil-green), var(--brazil-blue));box-shadow:0 8px 30px rgba(0,0,0,0.1);color:#fff}
    .hero h1{margin:0;font-size:28px}
    .hero p{margin:8px 0 16px;color:rgba(255,255,255,0.9)}
    .cta{display:inline-block;padding:10px 16px;border-radius:12px;background:var(--brazil-yellow);color:var(--brazil-blue);font-weight:700;cursor:pointer}
    .hero-ill{border-radius:12px;overflow:hidden}
    .categories{display:grid;grid-template-columns:repeat(6,1fr);gap:12px;margin-top:18px}
    .cat{background:var(--card);padding:12px;border-radius:12px;text-align:center;cursor:pointer;transition:all .2s}
    .cat:hover{transform:translateY(-6px)}
    .cat i{font-size:22px;color:var(--brazil-green)}
    .cat small{display:block;color:var(--text)}
    .controls{display:flex;gap:12px;align-items:center;margin:18px 0}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 10px;border-radius:999px;background:var(--card);cursor:pointer;color:var(--text)}
    .chip.active{background:linear-gradient(90deg,var(--brazil-green),var(--light-green));color:#002776;font-weight:700}
    .products.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
    .products.list{display:flex;flex-direction:column;gap:12px}
    .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.1);transition:all .25s;display:flex;flex-direction:column;color:var(--text)}
    .card:hover{transform:translateY(-6px)}
    .card .img{height:170px;border-radius:8px;overflow:hidden;position:relative}
    .badge{position:absolute;margin:10px;padding:6px 8px;border-radius:8px;font-size:13px;font-weight:700}
    .badge.offer{background:var(--brazil-yellow);color:var(--brazil-blue)}
    .card .info{padding:8px 0;flex:1}
    .price{font-weight:800;font-size:18px;color:var(--brazil-green)}
    .old{font-size:13px;color:rgba(0,0,0,0.5);text-decoration:line-through;margin-left:8px}
    .rating{display:flex;gap:6px;align-items:center;color:var(--brazil-yellow)}
    .card .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .card .actions{display:flex;gap:8px}
    .fav{background:transparent;border:0;color:var(--text);cursor:pointer}
    .cart-dropdown{position:absolute;right:0;top:44px;background:var(--card);width:340px;border-radius:12px;padding:12px;border:1px solid rgba(0,0,0,0.05);box-shadow:0 12px 40px rgba(0,0,0,0.1);display:none;color:var(--text)}
    .cart-dropdown.visible{display:block}
    .cart-item{display:flex;gap:10px;align-items:center;padding:8px 0;border-bottom:1px dashed rgba(0,0,0,0.05)}
    .qty{display:flex;gap:6px;align-items:center}
    .overlay{position:fixed;inset:0;background:rgba(2,6,12,0.6);display:none;align-items:center;justify-content:center;padding:20px}
    .overlay.open{display:flex}
    .modal{background:var(--card);border-radius:12px;padding:14px;max-width:900px;width:100%;max-height:90vh;overflow:auto;color:var(--text)}
    .modal .modal-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .thumbs{display:flex;gap:8px;margin-top:8px}
    .thumbs img{width:60px;height:60px;object-fit:cover;border-radius:6px;cursor:pointer}
    .flash{margin-top:22px;padding:18px;border-radius:12px;background:linear-gradient(135deg,var(--brazil-blue), #004080);box-shadow:0 10px 30px rgba(0,0,0,0.1);color:#fff}
    .timer{font-weight:800;font-size:20px}
    .toasts{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:8px}
    .toast{background:var(--card);padding:10px 12px;border-radius:10px;min-width:220px;box-shadow:0 8px 30px rgba(0,0,0,0.1);color:var(--text)}
    footer{margin-top:30px;padding:28px;background:var(--card);border-top:1px solid rgba(0,0,0,0.05);color:var(--text)}
    .footer-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media(max-width:1024px){.products.grid{grid-template-columns:repeat(3,1fr)}.hero{grid-template-columns:1fr 300px}}
    @media(max-width:768px){.categories{grid-template-columns:repeat(3,1fr)}.products.grid{grid-template-columns:repeat(2,1fr)}.hero{grid-template-columns:1fr}.header-main{padding:8px}.topbar{padding:8px}}
    @media(max-width:420px){.categories{grid-template-columns:repeat(2,1fr)}.products.grid{grid-template-columns:1fr}.nav{overflow:auto;white-space:nowrap}}
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">
      <div class="logo">ðŸ‡§ðŸ‡· Mercado Brasil</div>
      <div class="tag">Conectando o Brasil</div>
    </div>
    <div class="top-actions">
      <button class="btn" id="accountBtn"><i class="fas fa-user"></i> Minha Conta</button>
      <div class="cart">
        <button class="btn" id="cartBtn"><i class="fas fa-shopping-cart"></i> Carrinho <span class="count" id="cartCount">0</span></button>
        <div class="cart-dropdown" id="cartDropdown"></div>
      </div>
    </div>
  </div>

  <div class="header-main container">
    <div class="search-wrap">
      <div class="search">
        <i class="fas fa-search" style="margin-right:8px;color:rgba(255,255,255,0.6)"></i>
        <input id="searchInput" placeholder="Busque produtos, marcas e muito mais..." autocomplete="off">
        <button class="btn" id="voiceBtn" title="Pesquisa rÃ¡pida">OK</button>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="btn" id="viewToggle">Grid</button>
        <select id="sortSel" class="btn">
          <option value="relevance">Relevantes</option>
          <option value="priceAsc">Menor PreÃ§o</option>
          <option value="priceDesc">Maior PreÃ§o</option>
          <option value="rating">Melhor Avaliado</option>
          <option value="new">Mais Recentes</option>
        </select>
      </div>
    </div>
    <div class="nav">
      <a href="#">InÃ­cio</a>
      <a href="#cats">Categorias</a>
      <a href="#ofertas">Ofertas</a>
      <a href="#vendedores">Vendedores</a>
      <a href="#ajuda">Ajuda</a>
    </div>
  </div>

  <main class="container">
    <section class="hero">
      <div>
        <h1>Super Ofertas de Setembro!</h1>
        <p>AtÃ© 70% de desconto em produtos selecionados â€” corre que Ã© por tempo limitado.</p>
        <div style="display:flex;gap:12px">
          <button class="cta" id="ctaOffers">Ver Ofertas</button>
          <button class="btn" onclick="showToast('Boas compras!','info')">Navegar</button>
        </div>
      </div>
      <div class="hero-ill"><img src="https://images.unsplash.com/photo-1523475496153-3d6ccf77e4b0?w=900" alt="hero"></div>
    </section>

    <section style="margin-top:18px">
      <h3>Categorias</h3>
      <div id="cats" class="categories" aria-hidden="false"></div>
    </section>

    <section style="margin-top:18px">
      <div class="controls">
        <div class="chips" id="categoryChips"></div>
        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
          <button class="btn" id="loadMoreBtn">Carregar Mais</button>
        </div>
      </div>

      <div id="products" class="products grid"></div>
      <div style="text-align:center;margin-top:12px"><button class="btn" id="loadMoreBtnBottom">Carregar Mais</button></div>
    </section>

    <section id="ofertas" class="flash">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <h3 style="margin:0;color:var(--brazil-yellow)">Ofertas RelÃ¢mpago</h3>
          <div class="timer" id="flashTimer">00:00:00</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" onclick="resetFlash()">Reiniciar</button>
        </div>
      </div>
      <div style="margin-top:12px" id="flashGrid" class="products grid"></div>
    </section>

  </main>

  <!-- footer -->
  <footer>
    <div class="container footer-grid">
      <div>
        <h4>Sobre o Mercado Brasil</h4>
        <p>Uma ideia fictÃ­cia, porÃ©m linda. Mercado Brasil conecta vendedores e compradores com rapidez e confianÃ§a.</p>
        <div style="margin-top:8px">Siga-nos: <i class="fab fa-instagram"></i> <i class="fab fa-facebook"></i></div>
      </div>
      <div>
        <h4>Para Compradores</h4>
        <ul style="list-style:none;padding:0;margin:0">
          <li>Como comprar</li>
          <li>Meus pedidos</li>
          <li>Parcelamento</li>
        </ul>
      </div>
      <div>
        <h4>Para Vendedores</h4>
        <ul style="list-style:none;padding:0;margin:0">
          <li>Abra sua loja</li>
          <li>Vender no Mercado Brasil</li>
        </ul>
      </div>
      <div>
        <h4>Atendimento</h4>
        <p>contato@mercadobrasil.fake<br/>Telefone: (11) 4000-0000</p>
      </div>
    </div>
    <div style="text-align:center;margin-top:18px;color:rgba(255,255,255,0.6)">Â© 2025 Mercado Brasil Â· Todos os direitos reservados Â· <i class="fab fa-cc-visa"></i> <i class="fab fa-cc-mastercard"></i> PIX</div>
  </footer>

  <!-- overlays -->
  <div class="overlay" id="overlay">
    <div class="modal" id="modal">
      <!-- content injected by JS -->
    </div>
  </div>

  <!-- login modal -->
  <div class="overlay" id="loginOverlay">
    <div class="modal" style="max-width:420px">
      <h3>Entrar</h3>
      <form id="loginForm">
        <div style="margin-top:8px"><label>Email</label><input id="email" required style="width:100%;padding:8px;margin-top:6px;border-radius:8px;border:0;background:rgba(255,255,255,0.04);color:var(--text)"></div>
        <div style="margin-top:8px"><label>Senha</label><input id="password" type="password" required style="width:100%;padding:8px;margin-top:6px;border-radius:8px;border:0;background:rgba(255,255,255,0.04);color:var(--text)"></div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button type="button" class="btn" onclick="closeLogin()">Cancelar</button>
          <button type="submit" class="btn">Entrar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toasts" id="toasts"></div>

  <script>
  // ----------------- APP STATE -----------------
  const APP_STATE = {
    cart: [],
    favorites: [],
    currentCategory: 'all',
    currentSort: 'relevance',
    currentView: 'grid',
    searchQuery: '',
    currentUser: null
  };

  // ------------- PRODUCTS DB -------------------
  const PRODUCTS = [
    {id:1,title:'iPhone 15 Pro Max 256GB',price:8999,oldPrice:9999,category:'electronics',seller:'Apple Store Brasil',rating:4.8,reviews:2847,images:['https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=500','https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=500'],badge:'Oferta'},
    {id:2,title:'TÃªnis Nike Air Max 90',price:599.99,oldPrice:799.99,category:'fashion',seller:'Nike Oficial',rating:4.6,reviews:1245,images:['https://images.unsplash.com/photo-1491553895911-0055eca6402d?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8OHx8dGVuaXMlMjBuaWtlfGVufDB8fDB8fHww'],badge:'25% OFF'},
    {id:3,title:'MacBook Pro 15" M4 24GB RAM SSD 1TB Prateado',price:13999.00,oldPrice:20000.99,category:'electronics',seller:'Apple Store Brasil',rating:4.5,reviews:532,images:['https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=500'],badge:'Bestseller'},
    {id:4,title:'Cafeteira Nespresso Vertuo',price:899.99,oldPrice:1199.99,category:'home',seller:'Nespresso',rating:4.4,reviews:210,images:['https://images.unsplash.com/photo-1588931196804-75b9cb0cd2a1?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MjR8fG0lQzMlQTFxdWluYSUyMGRlJTIwY2FmJUMzJUE5fGVufDB8fDB8fHww'],badge:'Premium'},
    {id:5,title:'Smart TV LG 55" 4K OLED',price:4999.99,oldPrice:6999.99,category:'electronics',seller:'LG Store',rating:4.7,reviews:678,images:['https://plus.unsplash.com/premium_photo-1664302149029-50514758ed8b?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8c21hcnQlMjB0dnxlbnwwfHwwfHx8MA%3D%3D']},
    {id:6,title:'Bicicleta Mountain Bike Aro 29',price:1899.99,oldPrice:2499.99,category:'sports',seller:'Bike Center',rating:4.3,reviews:154,images:['https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8YmlrZXxlbnwwfHwwfHx8MA%3D%3D']},
    {id:7,title:'Livro: CiÃªncia de Dados para Todos',price:79.9,oldPrice:99.9,category:'books',seller:'Editora Tec',rating:4.9,reviews:87,images:['https://images.unsplash.com/photo-1512820790803-83ca734da794?w=500']},
    {id:8,title:'Produtos de Beleza: Kit Skincare',price:129.9,oldPrice:199.9,category:'beauty',seller:'Beleza BR',rating:4.2,reviews:321,images:['https://images.unsplash.com/photo-1591130901921-3f0652bb3915?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8c2tpbmNhcmUlMjBwcm9kdWN0c3xlbnwwfHwwfHx8MA%3D%3D']},
    {id:9,title:'Fone de Ouvido Headset Gamer',price:249.9,oldPrice:349.9,category:'electronics',seller:'Logitech',rating:4.1,reviews:412,images:['https://plus.unsplash.com/premium_photo-1679177184017-7777cdbb2ba5?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8aGVhZHNldCUyMGdhbWVyfGVufDB8fDB8fHww']},
    {id:10,title:'Camiseta BÃ¡sica AlgodÃ£o',price:49.9,oldPrice:69.9,category:'fashion',seller:'Loja Estilo',rating:4.0,reviews:98,images:['https://plus.unsplash.com/premium_photo-1689629728966-0d248b5aeda2?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8YmFzaWMlMjBzaGlydHxlbnwwfHwwfHx8MA%3D%3D']},
    {id:11,title:'Kit Jardinagem Casa & Jardim',price:159.9,oldPrice:199.9,category:'home',seller:'Casa Verde',rating:4.3,reviews:44,images:['https://plus.unsplash.com/premium_photo-1678457828849-89342358aa9a?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mzl8fGtpdCUyMGphcmRpbmFnZW18ZW58MHx8MHx8fDA%3D']},
    {id:12,title:'Halteres AjustÃ¡veis 20kg',price:299.9,oldPrice:399.9,category:'sports',seller:'ProFit',rating:4.5,reviews:76,images:['https://plus.unsplash.com/premium_photo-1671028546491-f70b21a32cc2?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8aGFsdGVyZXN8ZW58MHx8MHx8fDA%3D'],badge:'Oferta'},
    {id:13,title:'Box de Livros: ClÃ¡ssicos',price:199.9,oldPrice:299.9,category:'books',seller:'Livraria Central',rating:4.6,reviews:54,images:['https://plus.unsplash.com/premium_photo-1677231559663-b9f6a7c33c77?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8Y2xhc3NpY2FsJTIwYm9va3N8ZW58MHx8MHx8fDA%3D']},
    {id:14,title:'Perfume Masculino 100ml',price:229.9,oldPrice:329.9,category:'beauty',seller:'FragÃ¢ncias BR',rating:4.4,reviews:88,images:['https://images.unsplash.com/photo-1523293182086-7651a899d37f?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NXx8cGVyZnVtZXxlbnwwfHwwfHx8MA%3D%3D']}
  ];

  // categories meta
  const CATEGORIES = [
    {id:'electronics',label:'EletrÃ´nicos',icon:'fas fa-laptop',count:1234},
    {id:'fashion',label:'Moda',icon:'fas fa-tshirt',count:2567},
    {id:'home',label:'Casa & Jardim',icon:'fas fa-home',count:987},
    {id:'sports',label:'Esportes',icon:'fas fa-dumbbell',count:654},
    {id:'books',label:'Livros',icon:'fas fa-book',count:432},
    {id:'beauty',label:'Beleza',icon:'fas fa-heart',count:876}
  ];

  // ----------- UI BUILDERS -----------------
  const catsEl = document.getElementById('cats');
  const categoryChips = document.getElementById('categoryChips');
  const productsEl = document.getElementById('products');
  const flashGrid = document.getElementById('flashGrid');
  const cartCount = document.getElementById('cartCount');
  const cartBtn = document.getElementById('cartBtn');
  const cartDropdown = document.getElementById('cartDropdown');
  const overlay = document.getElementById('overlay');
  const modal = document.getElementById('modal');
  const toasts = document.getElementById('toasts');

  function init(){
    renderCategories();
    renderChips();
    renderProducts();
    renderFlash();
    attachEvents();
    startCountdown();
  }

  function renderCategories(){
    catsEl.innerHTML='';
    CATEGORIES.forEach(c=>{
      const el = document.createElement('div');el.className='cat';el.innerHTML=`<div><i class="${c.icon}"></i></div><div style=margin-top:8px>${c.label}</div><small>${c.count} produtos</small>`;
      el.onclick = ()=>{handleFilterChange(c.id)};
      catsEl.appendChild(el);
    })
  }

  function renderChips(){
    categoryChips.innerHTML='';
    const allChip = document.createElement('div');allChip.className='chip'+(APP_STATE.currentCategory==='all'?' active':'');allChip.textContent='Todos';allChip.onclick=()=>handleFilterChange('all');categoryChips.appendChild(allChip);
    CATEGORIES.forEach(c=>{const ch=document.createElement('div');ch.className='chip'+(APP_STATE.currentCategory===c.id?' active':'');ch.textContent=c.label;ch.onclick=()=>handleFilterChange(c.id);categoryChips.appendChild(ch)})
  }

  function formatPrice(v){return v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}

  function getFiltered(){
    let list = PRODUCTS.filter(p=> (APP_STATE.currentCategory==='all'||p.category===APP_STATE.currentCategory));
    if(APP_STATE.searchQuery) list = list.filter(p=> (p.title+ ' '+p.seller).toLowerCase().includes(APP_STATE.searchQuery.toLowerCase()));
    // sort
    switch(APP_STATE.currentSort){
      case 'priceAsc': list.sort((a,b)=>a.price-b.price);break;
      case 'priceDesc': list.sort((a,b)=>b.price-a.price);break;
      case 'rating': list.sort((a,b)=>b.rating-a.rating);break;
      case 'new': list = list.slice().reverse();break;
      default: break;
    }
    return list;
  }

  function renderProducts(){
    const list = getFiltered();
    productsEl.className = 'products '+ (APP_STATE.currentView==='grid'?'grid':'list');
    productsEl.innerHTML='';
    list.forEach(p=>{
      const card = document.createElement('div');card.className='card';
      const imgWrap = document.createElement('div');imgWrap.className='img';imgWrap.style.position='relative';
      const badge = p.badge?`<div class="badge offer" style="position:absolute;left:10px;top:10px">${p.badge}</div>`:'';
      imgWrap.innerHTML = `${badge}<img src="${p.images[0]}" alt="${p.title}" style="width:100%;height:100%;object-fit:cover;border-radius:8px">`;
      card.appendChild(imgWrap);
      const info = document.createElement('div');info.className='info';
      info.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><strong>${p.title}</strong><div class="rating">${p.rating} <i class="fas fa-star"></i></div></div>
      <div style="margin-top:8px" class="price">${formatPrice(p.price)} <span class="old">${p.oldPrice?formatPrice(p.oldPrice):''}</span></div>
      <div style="margin-top:6px;color:rgba(255,255,255,0.6)">Vendedor: ${p.seller}</div>`;
      card.appendChild(info);
      const meta = document.createElement('div');meta.className='meta';
      meta.innerHTML = `<div class="actions"><button class="btn" onclick="openProductModal(${p.id})">Comprar</button><button class="fav" onclick="toggleFavorite(${p.id},event)"><i class="fa-heart ${APP_STATE.favorites.includes(p.id)?'fas':'far'}"></i></button></div>
      <div><button class="btn" onclick="addToCart(${p.id})">+ Carrinho</button></div>`;
      card.appendChild(meta);
      productsEl.appendChild(card);
    })
  }

  // -------- CART ----------------
  function updateCartUI(){
    cartCount.textContent = APP_STATE.cart.reduce((s,i)=>s+i.qty,0);
    renderCartDropdown();
  }
  function renderCartDropdown(){
    cartDropdown.innerHTML='';
    if(APP_STATE.cart.length===0){cartDropdown.innerHTML='<div style="padding:12px;text-align:center;color:rgba(255,255,255,0.6)">Seu carrinho estÃ¡ vazio</div>';return}
    APP_STATE.cart.forEach(item=>{
      const p = PRODUCTS.find(x=>x.id===item.id);
      const el = document.createElement('div');el.className='cart-item';
      el.innerHTML = `<img src="${p.images[0]}" style="width:64px;height:64px;object-fit:cover;border-radius:8px"><div style="flex:1"><strong>${p.title}</strong><div style="color:rgba(255,255,255,0.6)">${formatPrice(p.price)}</div></div>
      <div class="qty"><button class="btn" onclick="changeQty(${p.id},-1)">-</button><div style="padding:6px">${item.qty}</div><button class="btn" onclick="changeQty(${p.id},1)">+</button></div>
      <div style="margin-left:8px"><button class="btn" onclick="removeFromCart(${p.id})">Remover</button></div>`;
      cartDropdown.appendChild(el);
    })
    const total = APP_STATE.cart.reduce((s,i)=>{const p=PRODUCTS.find(x=>x.id===i.id);return s+p.price*i.qty},0);
    const footer = document.createElement('div');footer.style.marginTop='8px';footer.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center"><strong>Total:</strong><strong>${formatPrice(total)}</strong></div><div style="margin-top:8px;display:flex;justify-content:space-between"><button class="btn" onclick="checkout()">Finalizar Compra</button><button class="btn" onclick="clearCart()">Limpar</button></div>`;
    cartDropdown.appendChild(footer);
  }

  function addToCart(productId){
    const existing = APP_STATE.cart.find(i=>i.id===productId);
    if(existing){existing.qty++;}else{APP_STATE.cart.push({id:productId,qty:1});}
    updateCartUI();
    showToast('Produto adicionado ao carrinho!','success');
  }
  function removeFromCart(itemId){APP_STATE.cart = APP_STATE.cart.filter(i=>i.id!==itemId);updateCartUI();showToast('Item removido do carrinho','warning');}
  function changeQty(productId,delta){const it=APP_STATE.cart.find(i=>i.id===productId);if(!it) return;it.qty+=delta;if(it.qty<1) APP_STATE.cart = APP_STATE.cart.filter(i=>i.id!==productId);updateCartUI();}
  function clearCart(){APP_STATE.cart=[];updateCartUI();}
  function checkout(){if(APP_STATE.cart.length===0){showToast('Carrinho vazio','error');return}showToast('Checkout simulado â€” obrigado!','success');APP_STATE.cart=[];updateCartUI();}

  // -------- FAVORITES -------------
  function toggleFavorite(id,event){event?.stopPropagation();const idx=APP_STATE.favorites.indexOf(id);if(idx===-1){APP_STATE.favorites.push(id);showToast('Produto adicionado aos favoritos','success')}else{APP_STATE.favorites.splice(idx,1);showToast('Produto removido dos favoritos','info')}renderProducts();}

  // -------- PRODUCT MODAL ---------
  function openProductModal(id){const p = PRODUCTS.find(x=>x.id===id);overlay.classList.add('open');
    modal.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><h3>${p.title}</h3><button class="btn" onclick="closeOverlay()">Fechar</button></div>
    <div class="modal-grid">
      <div>
        <div style="border-radius:8px;overflow:hidden"><img id="modalMainImg" src="${p.images[0]}" style="width:100%;height:320px;object-fit:cover;border-radius:8px"></div>
        <div class="thumbs">${p.images.map((u,idx)=>`<img src="${u}" onclick="document.getElementById('modalMainImg').src='${u}'">`).join('')}</div>
      </div>
      <div>
        <div style="font-weight:800;font-size:20px">${formatPrice(p.price)} <span style="font-size:14px;color:rgba(255,255,255,0.6);text-decoration:line-through;margin-left:8px">${p.oldPrice?formatPrice(p.oldPrice):''}</span></div>
        <div style="margin-top:8px">AvaliaÃ§Ã£o: ${p.rating} <i class="fas fa-star"></i> (${p.reviews} avaliaÃ§Ãµes)</div>
        <p style="margin-top:12px;color:rgba(255,255,255,0.8)">DescriÃ§Ã£o: Produto incrÃ­vel â€” descriÃ§Ã£o de demonstraÃ§Ã£o para ${p.title}.</p>
        <div style="margin-top:8px">Vendedor: <strong>${p.seller}</strong></div>
        <div style="margin-top:12px;display:flex;gap:8px;align-items:center">Quantidade: <input id="qtySelect" type="number" value="1" min="1" style="width:72px;padding:6px;border-radius:8px;background:rgba(255,255,255,0.03);border:0;color:var(--text)"></div>
        <div style="display:flex;gap:8px;margin-top:12px"><button class="btn" onclick="(function(){addToCartFromModal(${p.id})})()">Adicionar ao Carrinho</button><button class="btn" onclick="buyNow(${p.id})">Comprar Agora</button><button class="btn" onclick="toggleFavorite(${p.id})"><i class="fa-heart ${APP_STATE.favorites.includes(p.id)?'fas':'far'}"></i></button></div>
        <div style="margin-top:12px"><h4>Calcular frete</h4><input id="cepInput" placeholder="CEP" style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.03);border:0;color:var(--text)"><button class="btn" onclick="calculateShipping()">Calcular</button><div id="shippingResult" style="margin-top:8px;color:rgba(255,255,255,0.8)"></div></div>
      </div>
    </div>`;
  }
  function closeOverlay(){overlay.classList.remove('open');}
  function addToCartFromModal(id){const qty = Number(document.getElementById('qtySelect').value)||1;const existing = APP_STATE.cart.find(i=>i.id===id);if(existing) existing.qty+=qty; else APP_STATE.cart.push({id,qty});updateCartUI();showToast('Produto adicionado ao carrinho!','success');}
  function buyNow(id){addToCartFromModal(id);showToast('Redirecionando para pagamento (simulado)','info');}

  // -------- SEARCH & AUTOCOMPLETE -----
  const searchInput = document.getElementById('searchInput');
  let suggestionsEl;
  function attachEvents(){
    document.getElementById('ctaOffers').addEventListener('click',()=>{document.getElementById('ofertas').scrollIntoView({behavior:'smooth'})})
    document.getElementById('accountBtn').addEventListener('click',()=>{openLogin()});
    cartBtn.addEventListener('click',()=>{cartDropdown.classList.toggle('visible');});
    document.getElementById('viewToggle').addEventListener('click',toggleView);
    document.getElementById('sortSel').addEventListener('change',(e)=>{APP_STATE.currentSort=e.target.value;renderProducts();});
    document.getElementById('loadMoreBtn').addEventListener('click',loadMore);
    document.getElementById('loadMoreBtnBottom').addEventListener('click',loadMore);
    searchInput.addEventListener('input',handleSearch);
    document.getElementById('loginForm').addEventListener('submit',handleLogin);
    document.addEventListener('click',(e)=>{if(!cartDropdown.contains(e.target) && !cartBtn.contains(e.target)) cartDropdown.classList.remove('visible')});
  }

  function handleSearch(e){APP_STATE.searchQuery = e.target.value;renderProducts();}

  // -------- FILTERS ----------
  function handleFilterChange(category){APP_STATE.currentCategory=category;renderChips();renderProducts();}

  function handleSortChange(sortType){APP_STATE.currentSort=sortType;renderProducts();}

  function toggleView(){APP_STATE.currentView = APP_STATE.currentView==='grid'?'list':'grid';document.getElementById('viewToggle').textContent = APP_STATE.currentView==='grid'?'Grid':'Lista';renderProducts();}

  // ---------- LOAD MORE (simulado) ----------
  function loadMore(){showToast('Carregando mais produtos...','info');setTimeout(()=>{showToast('Mais produtos carregados (simulado)','success')},800)}

  // ---------- TOASTS --------------
  function showToast(message,type='info'){const el=document.createElement('div');el.className='toast';el.innerHTML=`<div style="font-weight:700">${message}</div>`;toasts.appendChild(el);setTimeout(()=>{el.style.transform='translateY(8px)';el.style.opacity='0';setTimeout(()=>el.remove(),400)},3000)}

  // ---------- FLASH OFFERS TIMER ----------
  let flashSeconds = 60*60; // 1 hour default
  function startCountdown(){setInterval(()=>{
    if(flashSeconds<=0){flashSeconds=60*60;renderFlash();}
    flashSeconds--;const h=Math.floor(flashSeconds/3600).toString().padStart(2,'0');const m=Math.floor((flashSeconds%3600)/60).toString().padStart(2,'0');const s=(flashSeconds%60).toString().padStart(2,'0');document.getElementById('flashTimer').textContent=`${h}:${m}:${s}`
  },1000)}
  function resetFlash(){flashSeconds=60*60;showToast('Timer reiniciado','info')}

  function renderFlash(){
    // pick some products with badge or high discount
    const picks = PRODUCTS.filter(p=>p.badge||p.oldPrice).slice(0,6);
    flashGrid.innerHTML='';
    picks.forEach(p=>{
      const card = document.createElement('div');card.className='card';card.innerHTML = `<div style="position:relative"><img src="${p.images[0]}" style="width:100%;height:160px;object-fit:cover;border-radius:8px"></div><div style="margin-top:8px;font-weight:700">${p.title}</div><div style="margin-top:6px" class="price">${formatPrice(p.price)} <span class="old">${p.oldPrice?formatPrice(p.oldPrice):''}</span></div><div style="margin-top:8px"><button class="btn" onclick="openProductModal(${p.id})">Comprar</button></div>`;
      flashGrid.appendChild(card);
    })
  }

  // ---------- SHIPPING CALC (simulado) ----------
  function calculateShipping(){const cep = document.getElementById('cepInput').value.trim();const res = document.getElementById('shippingResult');if(!cep){res.textContent='Informe um CEP vÃ¡lido';return}res.textContent='Calculando...';setTimeout(()=>{res.innerHTML=`OpÃ§Ãµes: <br/>Sedex â€” 3 dias â€” ${formatPrice(19.9)}<br/>Pac â€” 7 dias â€” ${formatPrice(9.9)}`},900)}

  // ---------- LOGIN ----------
  function openLogin(){document.getElementById('loginOverlay').classList.add('open')}
  function closeLogin(){document.getElementById('loginOverlay').classList.remove('open')}
  function handleLogin(e){e.preventDefault();const email = document.getElementById('email').value;APP_STATE.currentUser = {email};closeLogin();showToast('Login realizado com sucesso','success')}

  // ---------- UTIL ----------
  function checkout(){showToast('Finalizando compra (simulado)','info');APP_STATE.cart=[];updateCartUI();}

  // initial render
  init();
  updateCartUI();

  // expose some functions globally for inline onclick use
  window.addToCart = addToCart;
  window.removeFromCart = removeFromCart;
  window.toggleFavorite = toggleFavorite;
  window.openProductModal = openProductModal;
  window.closeOverlay = closeOverlay;
  window.changeQty = changeQty;
  window.calculateShipping = calculateShipping;
  window.addToCartFromModal = addToCartFromModal;
  window.buyNow = buyNow;
  window.handleFilterChange = handleFilterChange;
  window.handleSortChange = handleSortChange;
  window.showToast = showToast;
  window.resetFlash = resetFlash;
  window.clearCart = clearCart;
  window.checkout = checkout;
  window.openLogin = openLogin;
  window.closeLogin = closeLogin;

  </script>
</body>
</html>
